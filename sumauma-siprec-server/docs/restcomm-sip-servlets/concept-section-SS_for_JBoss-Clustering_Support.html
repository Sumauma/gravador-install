<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Understanding Restcomm  High Availabilty</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body id="_ssfjcs_ss_for_jboss_clustering_support" class="article">
<div id="header">
<h1>Understanding Restcomm  High Availabilty</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_sslb_mss_load_balancer">Load Balancer</a></li>
<li><a href="#_ssfjfs_ss_gracefulshutdown">Restcomm Graceful Shutdown</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">High Availability in Restcomm for JBoss AS7</div>
<div class="paragraph">
<p>Clustering and Failover features as described below are not yet implemented in Restcomm for JBoss AS7.
This guide will be updated when the feature becomes available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>High Availability</p>
</div>
<div class="paragraph">
<p>Is a term used to describe software and hardware based strategies that are implemented to ensure optimal performance and continuous system operation in case of failure.
High availability encompasses, clustering, failover and load balancing</p>
</div>
<div class="paragraph">
<p>Clustering</p>
</div>
<div class="paragraph">
<p>Is a technique used to ensure continuous service availability by having two or more servers communicate with each other and share configuration and application data (replication) on  fixed, predetermined intervals.
This produces two or more application servers with identical setup.
There is often a primary server within a clustered cloud from which data is replicated to the secondary.
The application servers within a clustered environment will use what is called a heartbeat to ensure that all servers within are alive and functioning.
In the case of failure, another server (secondary) will take over the task of responding to client&#8217;s requests without impacting user experience.
In some clustered ecosystem, load balancing is used as explained below.</p>
</div>
<div class="paragraph">
<p>Load Balancing</p>
</div>
<div class="paragraph">
<p>This is ultimately about performance.
All request from clients  are evenly distributed by the (load balancer) to multiple application servers that are running similar configurations.This type of setup often includes fault tolerance or failover.
When one of the nodes, application server instance is not available, all traffic will be directed to the remaining servers.
This ensures continuity albeit performance can degrade.
Load balancing allows a single point of entry for multiple clients.</p>
</div>
<div class="paragraph">
<p>Failover</p>
</div>
<div class="paragraph">
<p>Failover is a way to provide continuous service to clients connecting to an application server in case of system, software or hardware failure.
Connections to an unresponsive server is directed (failed over) to a backup server.
This is often done within the scope of a clustered configuration aided by a load balancer.</p>
</div>
<div class="paragraph">
<p>It is important to note that clustering is also a way to provide failover and enhance server performance.
The same can be said of load balancing.
The idea behind all the above mentioned techniques is to provide high availability to connecting clients connecting to applications running on Restcomm .
In a nutshell, high availability englobes all the above mentioned techniques.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sslb_mss_load_balancer"><a class="anchor" href="#_sslb_mss_load_balancer"></a>Load Balancer</h3>
<div class="imageblock">
<div class="content">
<img src="./images/mss-MSSSIPLoadBalancer-dia-StarNetworkTopology.jpg" alt="mss MSSSIPLoadBalancer dia StarNetworkTopology">
</div>
<div class="title">Figure 1. Star Cluster Topology.</div>
</div>
<div class="paragraph">
<p>The SIP Load Balancer is used to balance the load of SIP service requests and responses between nodes in a SIP Servlets Server cluster.
Both Restcomm for JBoss and Restcomm for Tomcat servers can be used in conjunction with the SIP Load Balancer to increase the performance and availability of SIP services and applications.</p>
</div>
<div class="paragraph">
<p>In terms of functionality, the SIP Load Balancer is a simple stateless proxy server that intelligently forwards SIP session requests and responses between User Agents (UAs) on a Wide Area Network (WAN), and SIP Servlets Server nodes, which are almost always located on a Local Area Network (LAN). All SIP requests and responses pass through the SIP Load Balancer.</p>
</div>
<div class="sect3">
<h4 id="_sslb_binary_sip_load_balancer_installing_configuring_and_running"><a class="anchor" href="#_sslb_binary_sip_load_balancer_installing_configuring_and_running"></a>SIP Load Balancer: Installing, Configuring and Running</h4>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_preinstall_requirements_and_prerequisites"><a class="anchor" href="#_sslb_binary_sip_load_balancer_preinstall_requirements_and_prerequisites"></a>Pre-Install Requirements and Prerequisites</h5>
<div class="dlist">
<div class="title">Software Prerequisites</div>
<dl>
<dt class="hdlist1">A JAIN SIP HA-enabled application server such as  Restcomm  JAIN SLEE or  Restcomm  SIP Servlets is required. </dt>
<dd>
<p>Running the SIP Load Balancer requires at least two instances of the application server as cluster nodes nodes.
Therefore, before configuring the SIP Load Balancer, we should make sure we&#8217;ve installed a the SIP application server first.
The Restcomm SIP load balancer will work with a SIP Servlets-enabled JBoss Application Server <em>or</em> a JAIN SLEE application server with SIP RA.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_downloading"><a class="anchor" href="#_sslb_binary_sip_load_balancer_downloading"></a>Downloading</h5>
<div class="paragraph">
<p>The load balancer is located in the <em class="path">sip-balancer</em> top-level directory of the Restcomm  distribution.
You will find the following files in the directory:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SIP load balancer executable JAR file</dt>
<dd>
<p>This is the binary file with all dependencies</p>
</dd>
<dt class="hdlist1">SIP load balancer Configuration Properties file</dt>
<dd>
<p>This is the properties files with various settings</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_installing"><a class="anchor" href="#_sslb_binary_sip_load_balancer_installing"></a>Installing</h5>
<div class="paragraph">
<p>The SIP load balancer executable JAR file can be extracted anywhere in the file system.
It is recommended that the file is placed in the directory containing other JAR executables, so it can be easily located in the future.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_configuring"><a class="anchor" href="#_sslb_binary_sip_load_balancer_configuring"></a>Configuring</h5>
<div class="paragraph">
<p>Configuring the SIP load balancer and the two SIP Servlets-enabled Server nodes is described in <a href="#_sslb_configuring_the_sip_load_balancer_and_servlet_server_nodes">Procedure: Configuring the Restcomm  SIP Load Balancer and SIP Server Nodes</a>.</p>
</div>
<div id="_sslb_configuring_the_sip_load_balancer_and_servlet_server_nodes" class="olist arabic">
<div class="title">Procedure: Configuring the Restcomm  SIP Load Balancer and SIP Server Nodes</div>
<ol class="arabic">
<li>
<p>Configure lb.properties Configuration Properties File</p>
<div class="paragraph">
<p>Configure the SIP Load Balancer&#8217;s Configuration Properties file by substituting valid values for your personal setup. <a href="#_sslb_complete_sample_lb.properties_file">Complete Sample lb.properties File</a>  shows a sample <em class="path">lb.properties</em> file, with key element descriptions provided after the example.
The lines beginning with the pound sign are comments.</p>
</div>
<div id="_sslb_complete_sample_lb.properties_file" class="exampleblock">
<div class="title">Example 1. Complete Sample lb.properties File</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>#  Load Balancer Settings
# For an overview of the   Load Balancer visit
# http://docs.google.com/present/view?id=dc5jp5vx_89cxdvtxcm
# The Load balancer will listen for both TCP and UDP connections



# The binding address of the load balancer. This also specifies the
# default value for both internalHost and externalHost if not specified separately.
host=127.0.0.1

# The binding address of the load balancer where clients should connect (if the host property is not specified)
#externalHost=127.0.0.1

# The SIP port from where servers will receive messages
# delete if you want to use only one port for both inbound and outbound)
internalPort=5065

# The SIP port used where clients should connect
externalPort=5060

# The binding address of the load balancer where SIP application servers should connect (if the host property is not specified)
#internalHost=127.0.0.1

# The RMI port used for heartbeat signals
rmiRegistryPort=2000

# The HTTP port for HTTP forwarding
# if you like to activate the integrated HTTP load balancer, this is the entry point
httpPort=2080
#If no nodes are active the LB can redirect the traffic to the unavailableHost specified in this property,
#otherwise, it will return 503 Service Unavailable
#unavailableHost=google.com

# If you are using IP load balancer, put the IP address and port here
#externalIpLoadBalancerAddress=127.0.0.1
#externalIpLoadBalancerPort=111

# Requests initited from the App Servers can route to this address (if you are using 2 IP load balancers for bidirectional SIP LB)
#internalIpLoadBalancerAddress=127.0.0.1
#internalIpLoadBalancerPort=111

# The addresses in the SIP LB Via headers can be either the real addresses or those specified in the external and internal IP LB addresses
useIpLoadBalancerAddressInViaHeaders=false

# Designate extra IP addresses as serer nodes
#extraServerNodes=222.221.21.12:21,45.6.6.7:9003,33.5.6.7,33.9.9.2

# Call-ID affinity algortihm settings. This algorithm is the default. No need to uncomment it.
#algorithmClass=org.mobicents.tools.sip.balancer.CallIDAffinityBalancerAlgorithm
# This property specifies how much time to keep an association before being evitcted.
# It is needed to avoid memory leaks on dead calls. The time is in seconds.
#callIdAffinityMaxTimeInCache=500
#The following attribute specified the policy after failover. If set to true all calls from the failed node
#will go to a new healthy node (all calls to the same node). If set to false the calls will go to random new nodes.
#callIdAffinityGroupFailover=false

# Uncomment to enable the consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.HeaderConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set, cna be "from.user" or "to.user" when you want the SIP URI username
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession

# Uncomment to enable the persistent consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.PersistentConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession

#This is the JBoss Cache 3.1 configuration file (with jgroups), if not specified it will use default
#persistentConsistentHashCacheConfiguration=/home/config.xml

# Call-ID affinity algortihm settings. This algorithm is the default. No need to uncomment it.
#algorithmClass=org.mobicents.tools.sip.balancer.CallIDAffinityBalancerAlgorithm
# This property specifies how much time to keep an association before being evitcted.
# It is needed to avoid memory leaks on dead calls. The time is in seconds.
#callIdAffinityMaxTimeInCache=500

# Uncomment to enable the consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.HeaderConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set, cna be "from.user" or "to.user" when you want the SIP URI username
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession

# Uncomment to enable the persistent consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.PersistentConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession

#This is the JBoss Cache 3.1 configuration file (with jgroups), if not specified it will use default
#persistentConsistentHashCacheConfiguration=/home/config.xml


#If a node doesnt check in within that time (in ms), it is considered dead
nodeTimeout=5100
#The consistency of the above condition is checked every heartbeatInterval milliseconds
heartbeatInterval=150


#JSIP stack configuration.....
javax.sip.STACK_NAME = SipBalancerForwarder
javax.sip.AUTOMATIC_DIALOG_SUPPORT = off
# You need 16 for logging traces. 32 for debug + traces.
# Your code will limp at 32 but it is best for debugging.
gov.nist.javax.sip.TRACE_LEVEL = 0

// Specify if message contents should be logged.
gov.nist.javax.sip.LOG_MESSAGE_CONTENT=false

gov.nist.javax.sip.DEBUG_LOG = logs/sipbalancerforwarderdebug.txt
gov.nist.javax.sip.SERVER_LOG = logs/sipbalancerforwarder.xml
gov.nist.javax.sip.THREAD_POOL_SIZE = 64
gov.nist.javax.sip.REENTRANT_LISTENER = true</pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">host</dt>
<dd>
<p>Local IP address, or interface, on which the SIP load balancer will listen for incoming requests.</p>
</dd>
<dt class="hdlist1">externalPort</dt>
<dd>
<p>Port on which the SIP load balancer listens for incoming requests from SIP User Agents.</p>
</dd>
<dt class="hdlist1">internalPort</dt>
<dd>
<p>Port on which the SIP load balancer forwards incoming requests to available, and healthy, SIP Server cluster nodes.</p>
</dd>
<dt class="hdlist1">rmiRegistryPort</dt>
<dd>
<p>Port on which the SIP load balancer will establish the RMI heartbeat connection to the application servers.
When this connection fails or a disconnection instruction is received, an application server node is removed and handling of requests continues without it by redirecting the load to the lie nodes.</p>
</dd>
<dt class="hdlist1">httpPort</dt>
<dd>
<p>Port on which the SIP load balancer will accept HTTP requests to be distributed across the nodes.</p>
</dd>
<dt class="hdlist1">internalTransport</dt>
<dd>
<p>Transport protocol for the internal SIP connections associated with the internal SIP port of the load balancer.
Possible choices are <code>UDP</code>, <code>TCP</code> and <code>TLS</code>.</p>
</dd>
<dt class="hdlist1">externalTransport</dt>
<dd>
<p>Transport protocol for the external SIP connections associated with the external SIP port of the load balancer.
Possible choices are <code>UDP</code>, <code>TCP</code> and <code>TLS</code>.
It must match the transport of the internal port.</p>
</dd>
<dt class="hdlist1">externalIpLoadBalancerAddress</dt>
<dd>
<p>Address of the IP load balancer (if any) used for incoming requests to be distributed in the direction of the application server nodes.
This address may be used by the SIP load balancer to be put in SIP headers where the external address of the SIP load balancer is needed.</p>
</dd>
<dt class="hdlist1">externalIpLoadBalancerPort</dt>
<dd>
<p>The port of the external IP load balancer.
Any messages arriving at this port should be distributed across the external SIP ports of a set of   SIP load balancers.</p>
</dd>
<dt class="hdlist1">internalIpLoadBalancerAddresst</dt>
<dd>
<p>Address of the IP load balancer (if any) used for outgoing requests (requests initiated from the servers) to be distributed in the direction of the clients.
This address may be used by the SIP load balancer to be put in SIP headers where the internal address of the SIP load balancer is needed.</p>
</dd>
<dt class="hdlist1">internalIpLoadBalancerPort</dt>
<dd>
<p>The port of the internal IP load balancer.
Any messages arriving at this port should be distributed across the internal SIP ports of a set of   SIP load balancers.</p>
</dd>
<dt class="hdlist1">extraServerNodes</dt>
<dd>
<p>Comma-separated list of hosts that are server nodes.
You can put here alternative names of the application servers here and they will be recognized.
Names are important, because they might be used for direction-analysis.
Requests coming from these server will go in the direction of the clients and will not be routed back to the cluster.</p>
</dd>
<dt class="hdlist1">algorithmClass</dt>
<dd>
<p>The fully-qualified Java class name of the balancing algorithm to be used.
There are three algorithms to choose from and you can write your own to implement more complex routing behaviour.
Refer to the sample configuration file for details about the available options for each algorithm.
Each algorithm can have algorithm-specific properties for fine-grained configuration.</p>
</dd>
<dt class="hdlist1">nodeTimeout</dt>
<dd>
<p>In milliseonds.
Default value is 5100.
If a server node doesnt check in within this time (in ms), it is considered dead.</p>
</dd>
<dt class="hdlist1">heartbeatInterval</dt>
<dd>
<p>In milliseconds.
Default value is 150 milliseonds.
The hearbeat interval  must be much smaller than the interval specified in the JAIN SIP property on the server machines - <code>org.mobicents.ha.javax.sip.HEARTBEAT_INTERVAL</code></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The remaining keys and properties in the configuration properties file can be used to tune the JAIN SIP stack, but are not specifically required for load balancing.
To assist with tuning, a comprehensive list of implementing classes for the SIP Stack is available from the <a href="https://mobicents.ci.cloudbees.com/job/JAIN-SIP/lastSuccessfulBuild/artifact/javadoc/javax/sip/SipStack.html">Interface SIP Stack</a>.
For a comprehensive list of properties associated with the SIP Stack implementation, refer to <a href="https://mobicents.ci.cloudbees.com/job/JAIN-SIP/lastSuccessfulBuild/artifact/javadoc/gov/nist/javax/sip/SipStackImpl.html">Class SipStackImpl</a>.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Configure logging</p>
<div class="paragraph">
<p>The SIP load balancer uses <a href="http://logging.apache.org/log4j">Log4J</a> as a logging mechanism.
You can configure it through the typical log4j xml configuration file and specify the path as follows <code>-DlogConfigFile=./log4j.xml</code>.
Please refer to Log4J documentation for more information on how to configure the logging.
A shortcut exists if you want to switch between INFO/DEBUG/WARN logging levels.
The JVM option <code>-DlogLevel=DEBUG</code> will allow you to switch all loggig categories to the specified log level.</p>
</div>
</li>
<li>
<p>Configure the container configuration file</p>
<div class="paragraph">
<p>Ensure the following attributes are configured for the <code>&lt;service&gt;</code> element in <em class="path">server.xml</em> for Tomcat or in the mobicents <code>subsystem</code> element for JBoss AS7.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>sipPathName</code> attribute must contain the following value <code>org.mobicents.ha.balancing.only</code> to indicate that the server will be using the Restcomm  JAIN SIP HA SIP Stack which is an extension of the JAIN SIP Stack offering integration with the Mobicents Load Balancer and transparent replication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure the <em class="path">mss-sip-stack.properties</em> configuration file</p>
<div class="ulist">
<ul>
<li>
<p>The <code>org.mobicents.ha.javax.sip.cache.MobicentsSipCache.cacheName</code> property must contain the name of the cache that will be responsible for holding the replicated data of the SIP Stack layer (namely the established SIP dialog data). The value has to be one of the cache name present in the jboss-cache-manager-jboss-beans.xml file of the jboss-cache-manager JBoss Service of the container.
The default value is <code>standard-session-cache</code></p>
</li>
<li>
<p>The <code>org.mobicents.ha.javax.sip.BALANCERS</code> property must be configured with the list of load balancer IP address and internal ports.
As an example, suppose a single &amp;THIS.PLATFORM; SIP Load Balancer is running with IP <code>192.168.0.1</code> and internal port <code>5065</code>, the property would be set with value <code>192.168.0.1:5065</code>.
To specify multiple balancers use <code>;</code> as separator.
If this property is used the balancers attribute located in server.xml should not be used as it is a replacement for it.</p>
</li>
<li>
<p>The <code>org.mobicents.ha.javax.sip.LoadBalancerHeartBeatingServiceClassName</code> property is optional, it defines the class name of the HeartBeating service implementation, currently the only one available is <code>org.mobicents.ha.javax.sip.LoadBalancerHeartBeatingServiceImpl</code></p>
</li>
<li>
<p>The <code>org.mobicents.ha.javax.sip.LoadBalancerElector</code> property is optional, it defines the class of the load balancer elector from JAIN SIP HA Stack.
The elector is used to define which load balancer will receive outgoing requests, which are out of dialog or in dialog with null state.
Currently only one elector implementation is available, <code>org.mobicents.ha.javax.sip.RoundRobinLoadBalancerElector</code>, which, as the class name says, uses round robin algorythm to select the balancer.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Configuration File Locations</div>
<div class="paragraph">
<p>On Restcomm for Tomcat server installations, <em class="path">server.xml</em> is located in <em class="path">&lt;install_directory&gt;/conf</em>.</p>
</div>
<div class="paragraph">
<p>On Restcomm for JBoss server installations, the default <em class="path">standalone-sip.xml</em> configuration file is located in <em class="path">standalone/configuration</em> or the default <em class="path">domain-sip.xml</em> configuration file located in <em class="path">domain/configuration</em> for cluster configurations</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Easy Node Configuration with JMX</div>
<p>Both SIP Servlet-enabled JBoss and Tomcat have  (Java Management Extensions) interfaces that allow for easy server configuration.
The JMX Console is available once the server has been started by navigating to <a href="http://localhost:8080/jmx-console/" class="bare">http://localhost:8080/jmx-console/</a>.</p>
</div>
<div class="paragraph">
<p>Both the <code>balancers</code> and <code>heartBeatInterval</code> attribute values are available under <code>name=-SIP-Servlets,type=load-balancer-heartbeat-service</code> in the JMX Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">balancers</dt>
<dd>
<p>Host names of the SIP load balancer(s) with corresponding <code>addBalancerAddress</code> and <code>removeBalancerAddress</code> methods.</p>
</dd>
<dt class="hdlist1">heartBeatInterval</dt>
<dd>
<p>Interval at which each heartbeat is sent to the SIP load balancer(s).</p>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="converged-load-balancing"><a class="anchor" href="#converged-load-balancing"></a>Converged Load Balancing</h6>
<div class="sect6">
<h7 id="apache-http-load-balancer"><a class="anchor" href="#apache-http-load-balancer"></a>Apache HTTP Load Balancer</h7>
<div class="paragraph">
<p>The Restcomm SIP Load Balancer can work in concert with HTTP load balancers such as <code>mod_jk</code>.
Whenever an HTTP session is bound to a particular node, an instruction is sent to the SIP Load Balancer to direct the SIP calls from the same application session to the same node.</p>
</div>
<div class="paragraph">
<p>It is sufficient to configure <code>mod_jk</code> to work for HTTP in JBoss in order to enable cooperative load balancing. Restcomm  will read the configuration and will use it without any extra configuration.
You can read more about configuring <code>mod_jk</code> with JBoss in your JBoss Application Server documentation.</p>
</div>
<div class="paragraph">
<p>Alternatively you may disable this behaviour and make the HTTP load balancer follow the decisions made by the SIP load balancer with the httpFollowsSip flag.
This is  achieved by changing the jvmRoute part of the session ID cookie used internally by <code>mod_jk</code>.</p>
</div>
<div class="sect7">
<h8 id="the-httpfollowssip-flag"><a class="anchor" href="#the-httpfollowssip-flag"></a>The httpFollowsSip flag</h8>
<div class="paragraph">
<p>The <code>httpFollowsSip</code> flag in the service configuration makes the application server aware of how different mod_jk and SIP load balancers have assigned  request affinity for each application session.
The application servers assign exactly one node to each Sip Servlets application session and this node is the node where the last SIP request associated with the application session has landed (decised by the SIP load balancer). Then the application server will actively update the session ID cookie (the jvmRoute part) of any HTTP request that arrives at  the wrong node.
The application server will do so with a specially composed HTTP redirect response or with a HTML refresh hint.
As a backup strategy, if the request is bound to seek non-existing node forever and it will let the request be served by a new node.
This avoids having a client stuck reloading the same page over and over.</p>
</div>
<div class="paragraph">
<p>One problem with this flag is that if you have two or more SIP sessions associated with the same application session and the load balancer has decided to send SIP requests to different nodes, which might happend if you use Call-ID based affinity, then the application server will have to change the jvmRoute very often for every SIP request resulting in significant overhead.
It is generally not adviced to enable this flag if you have more than 1 SIP session per application session and the means to guarantee all SIP sessions from the application session will land on the same node.</p>
</div>
<div class="paragraph">
<p>This is an example how to enable the option.
It is disabled by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;Connector port="5080"
     ipAddress = "${jboss.bind.address}"
     ...
     httpFollowsSip="true" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="integrated-http-load-balancer"><a class="anchor" href="#integrated-http-load-balancer"></a>Integrated HTTP Load Balancer</h7>
<div class="paragraph">
<p>To use the integrated HTTP Load Balancer, no extra configuration is needed.
If a unique <code>jvmRoute</code> is specified and enabled in each application server, it will behave exactly as the apache balancer.
If <code>jvmRoute</code> is not present, it will use the session ID as a hash value and attempt to create a sticky session.
The integrated balancer can be used together with the apache balancer at the same time.</p>
</div>
<div class="paragraph">
<p>In addition to the apache behavior, there is a consistent hash balancer algorithm that can be enabled for both HTTP and SIP messages.
For both HTTP and SIP messages, there is a configurable affinity key, which is evaluated and hashed against each unassigned request.
All requests with the same hash value will always be routed to the same application server node.
For example, the SIP affinity key could be the callee user name and the HTTP affinity key could the &#8220;appsession&#8221; HTTP GET parameter of the request.
If the desired behaviour group these requests, we can just make sure the affinity values (user name and GET parameter) are the same.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/converged-integrated-lb.png" alt="converged integrated lb">
</div>
<div class="title">Figure 2. Ensuring SIP and HTTP requests are being grouped by common affinity value.</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_running"><a class="anchor" href="#_sslb_binary_sip_load_balancer_running"></a>Running</h5>
<div class="olist arabic">
<div class="title">Procedure: Running the SIP Load Balancer and SIP Server Nodes</div>
<ol class="arabic">
<li>
<p>Start the SIP Load Balancer</p>
<div class="paragraph">
<p>Start the SIP load balancer, ensuring the Configuration Properties file (<em class="path">lb.properties</em> in this example) is specified.
In the Linux terminal, or using the Windows Command Prompt, the SIP Load Balancer is started by issuing a command similar to this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java -jar sip-balancer-jar-with-dependencies.jar lb-configuration.properties</pre>
</div>
</div>
<div class="paragraph">
<p>Executing the SIP load balancer produces  output similar to the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>home]$ java -jar sip-balancer-jar-with-dependencies.jar lb-configuration.properties
Oct 21, 2008 1:10:58 AM org.mobicents.tools.sip.balancer.SIPBalancerForwarder start
INFO: Sip Balancer started on address 127.0.0.1, external port : 5060, port : 5065
Oct 21, 2008 1:10:59 AM org.mobicents.tools.sip.balancer.NodeRegisterImpl startServer
INFO: Node registry starting...
Oct 21, 2008 1:10:59 AM org.mobicents.tools.sip.balancer.NodeRegisterImpl startServer
INFO: Node expiration task created
Oct 21, 2008 1:10:59 AM org.mobicents.tools.sip.balancer.NodeRegisterImpl startServer
INFO: Node registry started</pre>
</div>
</div>
<div class="paragraph">
<p>The output shows the IP address on which the SIP Load Balancer is listening, as well as the external and internal listener ports.</p>
</div>
</li>
<li>
<p>Configure SIP Server Nodes</p>
<div class="paragraph">
<p>SIP Servlets Server nodes can run on the JBoss Application Server, or the Tomcat Servlet Container.
The SIP Servlets Server binary distributions define the type of SIP Servlets Server nodes used, and should already be installed from <a href="#_sslb_binary_sip_load_balancer_software_prerequisites">[_sslb_binary_sip_load_balancer_software_prerequisites]</a>.</p>
</div>
<div class="paragraph">
<p>The Tomcat&#8217;s <em class="path">server.xml</em> or JBoss&#8217;s <em class="path">standalone-sip.xml</em> file specifies the nodes used.
Because there is more then one client node specified, unique listener ports must be specified for each node to monitor HTTP and/or SIP connections.
 <a href="#_bsssc_binary_sip_servlets_server_adding_sip_connectors">[_bsssc_binary_sip_servlets_server_adding_sip_connectors]</a> describes the affected element in the configuration file.</p>
</div>
</li>
<li>
<p>Start Load Balancer Client Nodes</p>
<div class="paragraph">
<p>Start all SIP load balancer client nodes.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_testing"><a class="anchor" href="#_sslb_binary_sip_load_balancer_testing"></a>Testing</h5>
<div class="paragraph">
<p>To test load balancing, the same application must be deployed manually on each node, and two SIP Softphones must be installed.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Testing Load Balancing</div>
<ol class="arabic">
<li>
<p>Deploy an Application</p>
<div class="paragraph">
<p>Ensure that for each node, the DAR file is the same.</p>
</div>
<div class="paragraph">
<p>Deploy the Location service manually on both nodes.</p>
</div>
</li>
<li>
<p>Start the "Sender" SIP softphone</p>
<div class="paragraph">
<p>Start a SIP softphone client with the SIP address of <code>sip:sender@sip-servlets-com</code>, listening on port 5055.
The outbound proxy must be specified as the sip-balancer (<a href="http://127.0.0.1:5060" class="bare">http://127.0.0.1:5060</a>)</p>
</div>
</li>
<li>
<p>Start the "Receiver" SIP softphone</p>
<div class="paragraph">
<p>Start a SIP softphone client with the SIP address of <code>sip:receiver-failover@sip-servlets-com</code>, listening on port 5090.</p>
</div>
</li>
<li>
<p>Initiate two calls from "Sender" SIP softphone</p>
<div class="paragraph">
<p>Initiate one call from <code>sip:sender@sip-servlets-com</code> to <code>sip:receiver-failover@sip-servlets-com</code>.
Tear down the call once completed.</p>
</div>
<div class="paragraph">
<p>Initiate a second call using the same SIP address, and tear down the call once completed.
Notice that the call is handled by the second node.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_stopping"><a class="anchor" href="#_sslb_binary_sip_load_balancer_stopping"></a>Stopping</h5>
<div class="paragraph">
<p>Assuming that you started the JBoss Application Server as a foreground process in the Linux terminal, the easiest way to stop it is by pressing the  key combination in the same terminal in which you started it.</p>
</div>
<div class="paragraph">
<p>This should produce similar output to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>^COct 21, 2008 1:11:57 AM org.mobicents.tools.sip.balancer.SipBalancerShutdownHook run
INFO: Stopping the sip forwarder</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sslb_binary_sip_load_balancer_uninstalling"><a class="anchor" href="#_sslb_binary_sip_load_balancer_uninstalling"></a>Uninstalling</h5>
<div class="paragraph">
<p>To uninstall the SIP load balancer, delete the JAR file you installed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ip-load-balancing"><a class="anchor" href="#ip-load-balancing"></a>IP Load Balancing</h4>
<div class="sect4">
<h5 id="ip-load-balancers"><a class="anchor" href="#ip-load-balancers"></a>IP Load Balancers</h5>
<div class="paragraph">
<p>An IP load-balancer is a network appliance that distributes traffic to an application server (or actual servers) using a  load-balancing algorithm.
IP load-balancing is often used when the other load-balancers' capacity is exceeded and can not scale further without hardware upgrades.</p>
</div>
<div class="paragraph">
<p>Routing decisions are made  based on OSI Layer 2, 3 or 4 data.
This type of load balancer only examines low-level TCP, UDP or ethernet packet structures including MAC addresses, IP addresses, ports, and protocol types (TCP or UDP or other).</p>
</div>
<div class="paragraph">
<p>An IP  load balancer never reads the payload of the TCP/IP packets and therefore never parses SIP or HTTP (or any protocol above OSI Layer 4).  Because an IP load balancing device is not SIP or HTTP aware in any way, it is much more performant than <code>mod_jk</code> or the Restcomm  SIP load-balancer.</p>
</div>
</div>
<div class="sect4">
<h5 id="technical-overview"><a class="anchor" href="#technical-overview"></a>Technical overview</h5>
<div class="paragraph">
<p>In its simplest form, the IP load-balancer usually "owns" the public-facing IP address (known as a VIP). The traffic is routed to actual servers in it&#8217;s private network similar to NAT.
It is also possible to not change the IP address and just work on the MAC address by assuming that all actual  servers are configured to accept packets for the VIP address.
The features offered by the IP load balancer depend largely on the vendor.</p>
</div>
<div class="paragraph">
<p>Some examples of  Linux-based  software load balancers include <a href="http://www.redhat.com/cluster_suite/">Red Hat Cluster Suite (RHCS)</a> and <a href="http://www.linuxvirtualserver.org/">Linux Virtual Server (LVS)</a>.
There are many hardware vendors as well.</p>
</div>
<div class="paragraph">
<p>One main drawback relating to  IP load balancers is that they can not make routing decisions based on SIP messages and (with some exceptions) they can not work cooperatively with HTTP or other load balancers.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-restcomm-cluster-for-pure-ip-load-balancing"><a class="anchor" href="#configuring-restcomm-cluster-for-pure-ip-load-balancing"></a>Configuring Restcomm  Cluster for pure IP Load Balancing</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pure IP load balancing is not a recommented option.
It is advised to use a distributed load balancer instead.
Proper operation with pure IP load balancing depends on the ability of the IP load balancer to establish request affinity based on IP addresses and ports.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First you need to remove the SIP load balancers from any configuration in Restcomm .
In particular the <code>org.mobicents.ha.javax.sip.BALANCERS</code>  attribute in <em class="path">mss-sip-stack.properties</em>.
You should remove the balancers attribute from the Service tag of  jboss.web service.
This simply removes the default load balancer from the system and the traffic bypasses the SIP load-balancer.
Next you must configure Restcomm  to put the IP load balancer IP address in the <code>Via</code>, <code>Contact</code> and other system headers where  the IP address of the server machine is required.
This will ensure that any responses or subsequent SIP requests follow the same path, but always hit  the load balancer instead of particular cluster node that may fail.
To specify the IP load balancer address in Restcomm  your should edit this file on Tomcat <em class="path">CATALINA_HOME/conf/server.xml</em> and specify <code>staticServerAddress</code> such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;Connector port="5080"
     ipAddress = "${jboss.bind.address}"
     ...
staticServerAddress="122.122.122.122" staticServerPort="44"
useStaticAddress="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and edit this file on JBoss <em class="path">JBOSS_HOME/standalone/configuration/standalone-sip.xml</em> and specify <code>staticServerAddress</code> such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;socket-binding name="sip-udp" port="5080"
     ...
staticServerAddress="122.122.122.122" staticServerPort="44"
useStaticAddress="true"/&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Depending on your reliability requirements you can omit the configuration described in this section and let the servers use their own IP address in the SIP messages.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sslb_sip_load_balancing_basics"><a class="anchor" href="#_sslb_sip_load_balancing_basics"></a>SIP Load Balancing Basics</h4>
<div class="paragraph">
<p>All User Agents send SIP messages, such as <code>INVITE</code> and <code>MESSAGE</code>, to the same SIP URI (the IP address and port number of the SIP Load Balancer on the WAN). The Load Balancer then parses, alters, and forwards those messages to an available node in the cluster.
If the message was sent as a part of an existing SIP session, it will be forwarded to the cluster node which processed that User Agent&#8217;s original transaction request.</p>
</div>
<div class="paragraph">
<p>The SIP Server that receives the message acts upon it and sends a response back to the SIP Load Balancer.
The SIP Load Balancer reparses, alters and forwards the message back to the original User Agent.
This entire proxying and provisioning process is carried out independent of the User Agent, which is only concerned with the SIP service or application it is using.</p>
</div>
<div class="paragraph">
<p>By using the Load Balancer, SIP traffic is balanced across a pool of available SIP Servers, increasing the overall throughput of the SIP service or application running on either individual nodes of the cluster.
In the case of a Restcomm server with <code>&lt;/distributed&gt;</code> capabilities, load balancing advantages are applied across the entire cluster.</p>
</div>
<div class="paragraph">
<p>The SIP Load Balancer is also able to failover requests mid-call from unavailable nodes to available ones, thus increasing the reliability of the SIP service or application.
The Load Balancer increases throughput and reliability by dynamically provisioning SIP service requests and responses across responsive nodes in a cluster.
This enables SIP applications to meet the real-time demand for SIP services.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-load-balancing-basics"><a class="anchor" href="#http-load-balancing-basics"></a>HTTP Load Balancing Basics</h4>
<div class="paragraph">
<p>In addition to the SIP load balancing, there are several options for coordinated or cooperative load balancing with other protocols such as HTTP.</p>
</div>
<div class="paragraph">
<p>Typically, a JBoss Application Server will use apache HTTP server with mod_jk, mod_proxy, mod_cluster or similar extension installed as an HTTP load balancer.
This apache-based load balancer will parse incoming HTTP requests and will look for the session ID of those requests in order to ensure all requests from the same session arrive at the same application server.</p>
</div>
<div class="paragraph">
<p>By default, this is done by examining the <code>jsessionid</code> HTTP cookie or GET parameter and looking for the <code>jvmRoute</code> assigned to the session.
The typical <code>jsessionid</code> value is of the form <code>&lt;sessionId&gt;.&lt;jvmRoute&gt;</code>.
The very first request for each new HTTP session does not have a session ID assigned; the apache routes the request to a random application server node.</p>
</div>
<div class="paragraph">
<p>When the node responds it assigns a session ID and <code>jvmRoute</code> to the response of the request in a HTTP cookie.
This response goes back to the client through apache, which keeps track of which node owns each <code>jvmRoute</code>.
Once the very first request is served this way, the subsequent requests from this session will carry the assigned cookie, and the apache load balancer will always route the requests to the node, which advertised itself as the <code>jvmRoute</code> owner.</p>
</div>
<div class="paragraph">
<p>Instead of using apache, an integrated HTTP Load Balancer is also available.
The SIP Load Balancer has a HTTP port where you can direct all incoming HTTP requests.
The integrated HTTP load balancer behaves exactly like apache by default, but this behavior is extensible and can be overridden completely with the pluggable balancer algorithms.
The integrated HTTP load balancer is much easier to configure and generally requires no effort, because it reuses most SIP settings and assumes reasonable default values.</p>
</div>
<div class="paragraph">
<p>Unlike the native apache, the integrated HTTP Load Balancer is written completely in Java, thus a performance penalty should be expected when using it.
However, the integrated HTTP Balancer has an advantage when related SIP and HTTP requests must stick to the same node.</p>
</div>
</div>
<div class="sect3">
<h4 id="pluggable-balancer-algorithms"><a class="anchor" href="#pluggable-balancer-algorithms"></a>Pluggable balancer algorithms</h4>
<div class="paragraph">
<p>The SIP/HTTP Load Balancer exposes an interface to allow users to customize the routing decision making for special purposes.
By default there are three built-in algorithms.
Only one algorithm is active at any time and it is specified with the <code>algorithmClass</code> property in the configuration file.</p>
</div>
<div class="paragraph">
<p>It is up to the algorithm how and whether to support distributed architecture or how to store the information needed for session affinity.
The algorithms will be called for every SIP and HTTP request and other significant events to make more informed decisions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Users must be aware that by default requests explicitly addressed to a live server node passing through the load balancer will be forwarded directly to the server node.
This allows for pre-specified routing use-cases, where the target node is known by the SIP client through other means.
If the target node is dead, then the node selection algorithm is used to route the request to an available node.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is a list of the built-in algorithms:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">org.mobicents.tools.sip.balancer.CallIDAffinityBalancerAlgorithm </dt>
<dd>
<p>This algorithm is not distributable.
It selects nodes randomly to serve a give Call-ID extracted from the requests and responses.
It keeps a map with  <code>Call-ID &#8594; nodeId</code> associations and this map is not shared with other load balancers which will cause them to make different decisions.
For HTTP it behaves like apache.</p>
</dd>
<dt class="hdlist1">org.mobicents.tools.sip.balancer.HeaderConsistentHashBalancerAlgorithm </dt>
<dd>
<p>This algorithm is distributable and can be used in distributed load balancer configurations.
It extracts the hash value of specific headers from SIP and HTTP messages to decide which application server node will handle the request.
Information about the options in this algorithms is available in the balancer configuration file comments.</p>
</dd>
<dt class="hdlist1">org.mobicents.tools.sip.balancer.PersistentConsistentHashBalancerAlgorithm </dt>
<dd>
<p>This algorithm is distributable and is similar to the previous algorithm, but it attempts to keep session affinity even when the cluster nodes are removed or added, which would normally cause hash values to point to different nodes.</p>
</dd>
<dt class="hdlist1">org.mobicents.tools.sip.balancer.ClusterSubdomainAffinityAlgorithm </dt>
<dd>
<p>This algorithm is not distributable, but supports grouping server nodes to act as a subcluster.
Any call of a node that belongs to a cluster group will be preferentially failed over to a node from the same group.
To configure a group you can just add the <code>subclusterMap</code> property in the load balancer properties and listing  the IP addresses of the nodes.
The nodes specified in a group do not have to alive and nodes that are not specified are still allowed to join the cluster. Otherwise the algorthim behaves exactly as the default Call-ID affinity algorthim.
The groups are enclosed in parentheses and the IP addresses are separate by commas as follows:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  subclusterMap=( 192.168.1.1, 192.168.1.2 ) ( 10.10.10.10,  20.20.20.20,  30.30.30.30)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="distributed-load-balancing"><a class="anchor" href="#distributed-load-balancing"></a>Distributed load balancing</h4>
<div class="paragraph">
<p>When the capacity of a single load balancer is exceeded, multiple load balancers can be used.
With the help of an IP load balancer the traffic can be distributed between all SIP/HTTP load balancers based on some IP rules or round-robin.
With consistent hash and <code>jvmRoute</code>-based balancer algorithms it doesn&#8217;t matter which SIP/HTTP load balancer will process the request, because they would all make the same decisions based on information in the requests (headers, parameters or cookies) and the list of available nodes.
With consistent hash algorithms there is no state to be preserved in the SIP/HTTP balancers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bidirectional-distributed-sip-lb.png" alt="bidirectional distributed sip lb">
</div>
<div class="title">Figure 3. Example deployment: IP load balancers serving both directions for incoming/outgoing requests in a cluster</div>
</div>
</div>
<div class="sect3">
<h4 id="_sslb_sip_load_balancer_implementation"><a class="anchor" href="#_sslb_sip_load_balancer_implementation"></a>Implementation of the Restcomm  Load Balancer</h4>
<div class="paragraph">
<p>Each individual Restcomm SIP Server in the cluster is responsible for contacting the SIP load balancer and relaying its health status and regular "heartbeats".</p>
</div>
<div class="paragraph">
<p>From these health status reports and heartbeats, the SIP Load Balancer creates and maintains a list of all available and healthy nodes in the cluster.
The Load Balancer forwards SIP requests between these cluster nodes, providing that the provisioning algorithm reports that each node is healthy and is still sending heartbeats.</p>
</div>
<div class="paragraph">
<p>If an abnormality is detected, the SIP Load Balancer removes the unhealthy or unresponsive node from the list of available nodes.
In addition, mid-session and mid-call messages are failed over to a healthy node.</p>
</div>
<div class="paragraph">
<p>The SIP Load Balancer first receives SIP requests from endpoints on a port that is specified in its Configuration Properties configuration file.
The SIP Load Balancer, using a round-robin algorithm, then selects a node to which it forwards the SIP requests.
The Load Balancer forwards all same-session requests to the first node selected to initiate the session, providing that the node is healthy and available.</p>
</div>
</div>
<div class="sect3">
<h4 id="sip-message-flow"><a class="anchor" href="#sip-message-flow"></a>SIP Message Flow</h4>
<div class="paragraph">
<p>The SIP Load Balancer appends itself to the <code>Via</code> header of each request, so that returned responses are sent to the SIP Balancer before they are sent to the originating endpoint.</p>
</div>
<div class="paragraph">
<p>The Load Balancer also adds itself to the path of subsequent requests by adding Record-Route headers.
It can subsequently handle mid-call failover by forwarding requests to a different node in the cluster if the node that originally handled the request fails or becomes unavailable.
The SIP load balancer immediately fails over if it receives an unhealthy status, or irregular heartbeats from a node.</p>
</div>
<div class="paragraph">
<p>In advanced configurations, it is possible to run more than one SIP Load Balancer.
Simply edit the balancers connection string in your SIP Server - the list is separated with semi-colon.</p>
</div>
<div class="paragraph">
<p><a href="#_figure_mss_basic_ip_and_port_cluster_configuration">Basic IP and Port Cluster Configuration</a> describes a basic IP and Port Cluster Configuration.
In the diagram, the SIP Load balancer is the server with the IP address of <code>192.168.1.1</code>.</p>
</div>
<div id="_figure_mss_basic_ip_and_port_cluster_configuration" class="imageblock">
<div class="content">
<img src="./images/mss-MSSSIPLoadBalancer-dia-ClusterIPsAndPorts.jpg" alt="mss MSSSIPLoadBalancer dia ClusterIPsAndPorts">
</div>
<div class="title">Figure 4. Basic IP and Port Cluster Configuration</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssfjfs_ss_gracefulshutdown"><a class="anchor" href="#_ssfjfs_ss_gracefulshutdown"></a>Restcomm Graceful Shutdown</h3>
<div class="paragraph">
<p>Graceful shutdown of a server or SIP/Web Applications is when existing request/connections/sessions are allowed to gracefully complete while no new requests and/or connections and/or sessions are accepted.
SIP Servlets Container or Applications can be gracefully shutdown through the Management Console, JMX or CLI as described below</p>
</div>
<div class="paragraph">
<p>As soon as the shutdown command is given, the container will stop the applications so that they do not accept any more inbound connections.
It will inform also load balancers that the server is no longer part of the cluster if the command is given on the container and not an individual application.
The Applications are closed so that they do not accept any more requests, but the requests currently inside the container will drain out and the Server instance will shutdown after the grace period expires.</p>
</div>
<div class="sect3">
<h4 id="_ssfjfs_ss_mssconsole_gracefulshutdown"><a class="anchor" href="#_ssfjfs_ss_mssconsole_gracefulshutdown"></a>Graceful Shutdown through Restcomm  SIP Servlets Management Console</h4>
<div class="imageblock">
<div class="content">
<img src="./images/mss-MSSSManagementConsole-ss-ServerControl.png" alt="mss MSSSManagementConsole ss ServerControl">
</div>
<div class="title">Figure 5. Graceful Shutdown of Container through Restcomm  SIP Servlets Management Console</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssfjfs_ss_wildfly_eap_cli_gracefulshutdown"><a class="anchor" href="#_ssfjfs_ss_wildfly_eap_cli_gracefulshutdown"></a>Graceful Shutdown of Container or Applications through Restcomm  JBoss AS/EAP Command Line Interface</h4>
<div class="paragraph">
<p>`To Gracefully shutdown an Application through the CLI `, use the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sh bin/jboss-cli.sh --connect  /subsystem=sip:contextGracefulShutdown\(timeToWait=30000,sipApp=appNameFromDeploymentDescriptor)</pre>
</div>
</div>
<div class="paragraph">
<p>`To Gracefully shutdown an Application through the CLI `, use the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sh bin/jboss-cli.sh --connect  /subsystem=sip:gracefulShutdown\(timeToWait=30000\)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssfjfs_ss_jmxconsole_gracefulshutdown"><a class="anchor" href="#_ssfjfs_ss_jmxconsole_gracefulshutdown"></a>Graceful Shutdown of Container or Applications through Restcomm  SIP Servlets JMX Console</h4>
<div class="paragraph">
<p>`To Gracefully shutdown an Application through the JMX Console, Find the 'SipManager' MBean corresponding to your application and go to the 'stopGracefully' operation, Fill out the 'Time To Wait' Field and click 'Invoke' Button `</p>
</div>
<div class="paragraph">
<p>`To Gracefully shutdown the Container through the JMX Console, Find the 'jboss.web:type=SipApplicationDispatcher' MBean and go to the 'stopGracefully' operation, Fill out the 'Time To Wait' Field and click 'Invoke' Button `</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-11-27 14:29:45 UTC
</div>
</div>
</body>
</html>