<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Application Router</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body id="_sssicar_sip_servlets_server_application_router" class="article">
<div id="header">
<h1>Application Router</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_tsdar_default_application_router">Default Application Router</a></li>
<li><a href="#_tsear_echarts_application_router">DFC Application Router</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Application Routing is performed within the Restcomm Sip Servlets container by the Default Application Router.
The following sections describe the Default Application Router, and how other JSR 289 compliant Application Router implementations can be installed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tsdar_default_application_router"><a class="anchor" href="#_tsdar_default_application_router"></a>Default Application Router</h3>
<div class="paragraph">
<p>The Application Router is called by the container to select a SIP Servlet application to service an initial request.
It embodies the logic used to choose which applications to invoke.</p>
</div>
<div class="sect3">
<h4 id="_tsdar_application_router_role"><a class="anchor" href="#_tsdar_application_router_role"></a>Role of the Application Router</h4>
<div class="paragraph">
<p>An Application Router is required for a container to function, but it is a separate logical entity from the container.
The Application Router is responsible for application selection and does not implement application logic.
For example, the Application Router cannot modify a request or send a response.</p>
</div>
<div class="paragraph">
<p>There is no direct interaction between the Application Router and applications, only between the SIP Servlets Container and the Application Router.</p>
</div>
<div class="paragraph">
<p>The SIP Servlets container is responsible for passing the required information to the Application Router within the initial request so the Application Router can make informed routing decisions.
The Application Router is free to make use of any information or data stores, except for the information passed by the container.
It is up to the individual implementation how the Application Router makes use of the information or data stores.</p>
</div>
<div class="paragraph">
<p>The deployer in a SIP Servlet environment controls application composition by defining and deploying the Application Router implementation.
Giving the deployer control over application composition is desirable because the deployer is solely responsible for the services available to subscribers.</p>
</div>
<div class="paragraph">
<p>Furthermore, the SIP Servlets specification intentionally allows the Application Router implementation to consult arbitrary information or data stores.
This is because the deployer maintains subscriber information and this information is often private and valuable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tsdar_mobicents_default_application_router"><a class="anchor" href="#_tsdar_mobicents_default_application_router"></a>Restcomm Default Application Router</h4>
<div class="paragraph">
<p>Restcomm SIP Servlets provides an implementation of the Default Application Router (DAR) as defined in the SIP Servlets 1.1 specification, Appendix C.</p>
</div>
<div class="sect4">
<h5 id="_tsdar_dar_configuration_file"><a class="anchor" href="#_tsdar_dar_configuration_file"></a>The DAR Configuration File</h5>
<div class="paragraph">
<p>The Default Application Router (DAR) obtains its operational parameters from a  configuration text file that is modeled as a Java properties file. The configuration file  contains the information needed by the Application Router to select which SIP Servlet application will handle an incoming initial request.</p>
</div>
<div class="paragraph">
<p>In the case of Restcomm SIP Servlets, it is also possible to configure the DAR through the <em class="path">server.xml</em> configuration file (see <a href="#_bsssc_configuring_the_service_element_in_the_containers_server.xml">[_bsssc_configuring_the_service_element_in_the_containers_server.xml]</a> and  <a href="#_wwtssmc_working_with_the_sip_servlets_management_console">[_wwtssmc_working_with_the_sip_servlets_management_console]</a>).</p>
</div>
<div class="paragraph">
<p>The properties file has the following characteristics and requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must be made available to the DAR.</p>
</li>
<li>
<p>It must allow the contents and file structure to be accessible from a hierarchical URI supplied as a system property <em class="path">javax.servlet.sip.ar.dar.configuration</em>.</p>
</li>
<li>
<p>It is first read by the container when it loads up and is refreshed each time an application is deployed and undeployed.</p>
</li>
<li>
<p>It has a simple format in which the name of the property is the SIP method and the value is a comma-separated string value for the <code>SipApplicationRouterInfo</code>          object.</p>
<div class="listingblock">
<div class="content">
<pre>INVITE: (sip-router-info-1), (sip-router-info-2)..
SUBSCRIBE: (sip-router-info-3), (sip-router-info-4)..
ALL: (sip-router-info-5), (sip-router-info-6)..</pre>
</div>
</div>
<div class="paragraph">
<p>Restcomm SIP Servlets defines a new keyword called <code>ALL</code>.
The keyword  allows mapping between the sip-router-info data, and all methods supported by the container (for example, INVITE, REGISTER, SUBSCRIBE). This mapping can  save time when configuring an application that listens to all incoming methods.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>ALL</code>, and a specific method are defined in the DAR file, the specific method takes precedence over <code>ALL</code>.
When the specific method no longer has applications to serve, <code>ALL</code> is enabled again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The sip-router-info data specified in the properties file is a string value version of the <code>SipApplicationRouterInfo</code> object.
It consists of the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the application as known to the container.
The application name can be obtained from the  element of the <em class="path">sip.xml</em> deployment descriptor of the application, or the <code>@SipApplication</code>          annotation.</p>
</li>
<li>
<p>The identity of the subscriber that the DAR returns.
The DAR can  return any header in the SIP request using the DAR directive <code>DAR:SIP_HEADER</code>.
For example,  <code>DAR:From</code> would return the SIP URI in the <code>From</code>          header.
The DAR can  alternatively  return any string from the SIP request.</p>
</li>
<li>
<p>The routing region, which consists of one of the following strings:  <code>ORIGINATING</code>, <code>TERMINATING</code> or <code>NEUTRAL</code>.
This information is not currently used by the DAR to make routing decisions.</p>
</li>
<li>
<p>A SIP URI indicating the route as returned by the Application Router, which can be used to route the request externally.
The value may be an empty string.</p>
</li>
<li>
<p>A route modifier, which consists of one of the following strings: <code>ROUTE</code>, <code>ROUTE_BACK</code> or <code>NO_ROUTE</code>.
The route modifier is used in conjunction with the  route information to route a request externally.</p>
</li>
<li>
<p>A string representing the order in which  applications must be invoked (starts at 0).  The string is removed later on in the routing process,  and substituted with the order positions of sip-router-info data.</p>
</li>
<li>
<p>An optional string that contains Restcomm -specific parameters.
Currently, only the <code>DIRECTION</code> and <code>REGEX</code> parameters are supported.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The field can contain unsupported <code>key=value</code> properties that may be supported in future releases.
The unsupported properties will be ignored during parsing, until support for the attributes is provided.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The syntax is demonstrated in <a href="#_example_dar_direction_example">[_example_dar_direction_example]</a>.</p>
</div>
</li>
<li>
<p>The <code>DIRECTION</code> parameter specifies whether an application serves external(INBOUND) requests or initiates (OUTBOUND) requests.</p>
<div class="paragraph">
<p>If an application is marked <code>DIRECTION=INBOUND</code>, it will not be called for requests initiated by applications behaving as UAC.
To mark an application as UAC, specify <code>DIRECTION=INBOUND</code> in the optional parameters in the DAR.</p>
</div>
<div class="paragraph">
<p>Applications that do not exist in the DAR list for the container are assumed to be <code>OUTBOUND</code>.
Because undefined applications are incapable of serving external requests, they must have self-initiated the request.
The Sip Servlets Management Console can be used to specify the <code>DIRECTION</code> parameter.</p>
</div>
<div class="paragraph">
<p>If an application is marked <code>DIRECTION=UAC_ROUTE_BACK</code>, the Application that acted as UAC will be called back if it present in the list of applications to be called for that particular message SIP method.</p>
</div>
</li>
<li>
<p>The <code>REGEX</code> parameter specifies a regular expression to be matched against the initial request passed to the Application Router.</p>
<div class="paragraph">
<p>If the regular expression matches a part of the initial request, the application is called.
If it does not, it is skipped.</p>
</div>
<div class="paragraph">
<p>For example, in the following sip-router-info data:</p>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>INVITE - ("org.mobicents.servlet.sip.testsuite.SimpleApplication", "DAR:From", "ORIGINATING", "", "NO_ROUTE", "0", "REGEX=From:.*sip:.*@sip-servlets\.com")</pre>
</div>
</div>
<div class="paragraph">
<p>only incoming initial requests with a From Header with a SIP URI that belongs to the sip-servlets.com domain will be passed to the SimpleApplication.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. DIRECTION Example</div>
<div class="content">
<div class="paragraph">
<p>In this example, two applications are declared for the <code>INVITE</code>   request.
The <code>LocationServiceApplication</code> is called for requests coming from outside the container, but it will not be called for the requests initiated by the UAC application <code>Click2DialApplication</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INVITE: ("org.mobicents.servlet.sip.testsuite.Click2DialApplication", "DAR:From",
"ORIGINATING", "", "NO_ROUTE", "0", "DIRECTION=OUTBOUND"), \
("org.mobicents.servlet.sip.testsuite.LocationServiceApplication", "DAR\:From",
"ORIGINATING", "", "NO_ROUTE", "0", "DIRECTION=INBOUND")</pre>
</div>
</div>
<div class="paragraph">
<p>This type of configuration is useful in cases where different application must be responsible for both requests initiated by the container,  and external requests received by the container.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. ORIGINATING/TERMINATING DAR Example</div>
<div class="content">
<div class="paragraph">
<p>In this example, the DAR is configured to invoke two applications on receipt of an INVITE request; one each in the originating and the terminating halves.
The applications are identified by their application deployment descriptor names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INVITE: ("OriginatingCallWaiting", "DAR:From", "ORIGINATING", "", "NO_ROUTE", "0"), ("CallForwarding", "DAR:To", "TERMINATING", "","NO_ROUTE", "1")</pre>
</div>
</div>
<div class="paragraph">
<p>For this example, the returned subscriber identity is the URI from each application&#8217;s  <code>From</code> and <code>To</code> headers respectively.
The DAR does not return any route to the container, and maintains the invocation state in the <code>stateInfo</code> as the index of the last application in the list.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="routing-of-sip-messages-to-applications"><a class="anchor" href="#routing-of-sip-messages-to-applications"></a>Routing of SIP Messages to Applications</h5>
<div class="sect5">
<h6 id="initial-requests-and-application-selection-process"><a class="anchor" href="#initial-requests-and-application-selection-process"></a>Initial Requests and Application Selection Process</h6>
<div class="paragraph">
<p>Initial Requests are those that can essentially be dialog creating (such as, <code>INVITE</code>, <code>SUBSCRIBE</code> and  <code>NOTIFY</code>),  and not part of an already existing dialog.</p>
</div>
<div class="paragraph">
<p>Initial requests are routed to applications deployed in the container according to the SIP Servlets 1.1 specification, Section 15.4.1 Procedure for Routing an Initial Request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are some other corner cases that apply to initial requests.
Refer to Appendix B, Definition of an Initial Request in the SIP Servlets 1.1 specification.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 3. INVITE Routing</div>
<div class="content">
<div class="paragraph">
<p>The following example describes how the DAR routes an INVITE to two applications  deployed in a container.
The applications in this example are a Location Service and a Call Blocking application.</p>
</div>
<div class="paragraph">
<p>In the example, the assumption of a request coming to the server is described.
However, applications can act as a UAC, and  generate initial requests on their own.
For routing purposes, it is not necessary for  the specified application initiating the request to have an  entry in the DAR file.</p>
</div>
<div class="paragraph">
<p>The DAR file  contains the required information for the  two applications to be invoked in the correct order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INVITE: ("LocationService", "DAR:From", "ORIGINATING", "", "NO_ROUTE", "0"), ("CallBlocking", "DAR:To", "TERMINATING", "","NO_ROUTE", "1")</pre>
</div>
</div>
<div class="paragraph">
<p>Processing occurs in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A new <code>INVITE</code> (not a re-INVITE) arrives at the container.</p>
<div class="paragraph">
<p>The <code>INVITE</code>  is a  dialog creating request, and is  not part of any dialog.</p>
</div>
</li>
<li>
<p>The Application Router is called.</p>
<div class="paragraph">
<p>From the <code>INVITE</code> information, the first application to invoke is the Location Service.</p>
</div>
</li>
<li>
<p>The Application Router returns  the application invocation order  information to the container (along with the rest of the sip-router-info data) so  the container knows which application to invoke.</p>
</li>
<li>
<p>The container   invokes the LocationService that proxies the <code>INVITE</code>.</p>
<div class="paragraph">
<p>The proxied <code>INVITE</code> is considered  as a new <code>INVITE</code> to the known IP Address of the registered user for the Request URI</p>
</div>
<div class="paragraph">
<p>For further information regarding <code>INVITE</code> handling, refer to  "Section 15.2.2 Sending an Initial Request" in the  SIP Servlets 1.1 Specification.</p>
</div>
</li>
<li>
<p>Because the <code>INVITE</code> has been proxied, the container  invokes the Application Router for the proxied <code>INVITE</code> to see if any more applications are interested in the event.</p>
</li>
<li>
<p>From the proxied invite, the Application Router determines that the second application to invoke is the Call Blocking application.</p>
</li>
<li>
<p>The Application Router returns  information regarding the Call Blocking application to the container (along with the rest of the sip-router-info data) so  the container knows which application to invoke.</p>
</li>
<li>
<p>The container routes the <code>INVITE</code> for the Call Blocking application to the next application in the chain.</p>
</li>
<li>
<p>The Call Blocking application determines  that the user that initiated the call  is black listed.
The application rejects the call with a "Forbidden" response.</p>
</li>
<li>
<p>Because the Call Blocking application acts as a UAS, the Application Selection Process is stopped for the original <code>INVITE</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The path  the <code>INVITE</code> has taken (that is, LocationService to  CallBlocking) is called the application path.
The routing of the responses will now occur as explained in the next section.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="response-routing"><a class="anchor" href="#response-routing"></a>Response Routing</h6>
<div class="paragraph">
<p>Responses always follow the reverse of the path taken by the corresponding request.
In our case, the Forbidden response will first go back to the LocationService, and then back to the caller.
This is true for responses to both initial and subsequent requests.
The application path is a logical concept and as such may or may not be explicitly represented within containers.</p>
</div>
<div class="paragraph">
<p>Another possible outcome could have been that the Call Blocking application, instead of sending a Forbidden response, allowed the call and proxied the INVITE to the same Request URI chosen by the Location Service.
Then when the callee sends back the 200 OK Response, this response goes back the same way through the application path (so in the present case Call Blocking, then Location Service, then back to the caller).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Call Blocking application cannot just do nothing with the request and expect the container to route the request in its place (either to a next application in chain if another one is present or to the outside world if none is present). The Application has to do something with request (either proxy it or act as a UAS).
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="subsequent-requests"><a class="anchor" href="#subsequent-requests"></a>Subsequent Requests</h6>
<div class="paragraph">
<p>Subsequent requests are all requests that are not Initial.</p>
</div>
<div class="paragraph">
<p>The second scenario, where the Call Blocking application allowed the call, will be used in this section to showcase subsequent requests.
The caller has received the 200 OK response back.
Now, according to the SIP specification (RFC 3261), it sends an ACK.
The ACK arrives at the container, and is not a dialog creating request and is already part of an ongoing dialog (early dialog) so the request is detected as a Subsequent request and will follow the application path created by the initial request.
The ACK will go through Location Service, Call Blocking, and finally to the callee.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tsdar_limitations"><a class="anchor" href="#_tsdar_limitations"></a>Limitations of the Default Application Router</h4>
<div class="paragraph">
<p>The DAR  is a minimalist Application Router implementation that is part of the reference implementation.
While it could be used instead of a production Application Router, it offers no processing logic except for  the declaration of the application order.</p>
</div>
<div class="paragraph">
<p>In real world deployments, the Application Router plays an extremely important role in application orchestration and composition.
It is likely that the Application Router would  make use of complex rules and diverse data repositories in future implementations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tsear_echarts_application_router"><a class="anchor" href="#_tsear_echarts_application_router"></a>DFC Application Router</h3>
<div class="sect3">
<h4 id="description-of-dfc-application-router"><a class="anchor" href="#description-of-dfc-application-router"></a>Description of DFC Application Router</h4>
<div class="paragraph">
<p>Instead of using the Restcomm Default Application Router, any SIP Servlets 1.1 compliant Application Router can be used, including the eCharts <a href="http://echarts.org/EChartsSipServletManual/sip-echartsse4.html#x6-140004.1">DFC Application Router</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="installing-the-dfc-application-router"><a class="anchor" href="#installing-the-dfc-application-router"></a>Installing the DFC Application Router</h4>
<div class="paragraph">
<p>Detailed instructions are available from <a href="http://echarts.org/Blog/Running-E4SS-apps-on-Mobicents-SIP-Servlets.html">the eCharts website</a>.
The following procedure describe how to install the eCharts DFC Application Router (DFCAR) on a variety of SIP Servlet Server platforms.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing DFCAR on Tomcat</div>
<ol class="arabic">
<li>
<p>Deploy the DFCAR</p>
<div class="paragraph">
<p>Drop the <em class="path">dfcar.jar</em> from the ECharts distribution package in the <code>TOMCAT_HOME/lib</code> directory.</p>
</div>
</li>
<li>
<p>Remove the DAR</p>
<div class="paragraph">
<p>Remove the Restcomm Default Application Router located in <code>TOMCAT_HOME/lib/sip-servlets-application-router-*.jar</code>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Please see the following link to learn how to deploy jar files in Restcomm for JBoss AS7.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing DFCAR on JBoss AS7</div>
<ol class="arabic">
<li>
<p>Deploy the DFCAR</p>
<div class="paragraph">
<p>Create a directory under <code>JBOSS_HOME/modules/system/layers/base/org/echarts/</code></p>
</div>
<div class="paragraph">
<p>Drop the <em class="path">dfcar.jar</em> from the ECharts distribution package in the <code>JBOSS_HOME/modules/system/layers/base/org/echarts/ </code>directory.</p>
</div>
<div class="paragraph">
<p>Create a <code>module.xml</code> file under the same directory with the following contents</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;module xmlns="urn:jboss:module:1.1" name="org.echarts"&gt;
&lt;resources&gt;
&lt;resource-root path="dfcar.jar"/&gt;
&lt;/resources&gt;
&lt;dependencies&gt;
&lt;module name="org.apache.log4j"/&gt;
&lt;module name="org.mobicents.javax.servlet.sip"/&gt;
&lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Remove the DAR</p>
<div class="paragraph">
<p>Remove the Restcomm Default Application Router located in  <code>JBOSS_HOME/modules/system/layers/base/org/mobicents/dar</code>.</p>
</div>
</li>
<li>
<p>Use the DFC DAR</p>
<div class="paragraph">
<p>In <code>JBOSS_HOME/modules/system/layers/base/org/jboss/as/web/main/module.xml</code>, replace the following line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;module name="org.mobicents.dar" export="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>by this one</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;module name="org.echarts" export="true"/&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-11-27 14:29:45 UTC
</div>
</div>
</body>
</html>